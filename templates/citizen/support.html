{% extends "citizen/base_citizen.html" %}
{% block title %}Get Support â€” CivicConnect{% endblock %}
{% block page_title %}Get Support{% endblock %}
{% block page_sub %}Reach city officials directly for assistance{% endblock %}
{% block content %}
<div class="section-title">ğŸ¯ Choose Support Type</div>
<div class="support-cards mb-6">
  <div class="support-option"><div class="support-icon">ğŸ¯</div><div class="support-title">Start Consultation</div><div class="support-desc">Schedule a formal consultation with the relevant department.</div><button class="btn btn-primary btn-sm" style="margin-top:16px" onclick="selectSupport(this,'Start Consultation')">Request Consultation</button></div>
  <div class="support-option"><div class="support-icon">ğŸ’¬</div><div class="support-title">Active Chat</div><div class="support-desc">Start a real-time chat session with a city representative.</div><button class="btn btn-accent btn-sm" style="margin-top:16px" onclick="selectSupport(this,'Active Chat')">Start Chat</button></div>
  <div class="support-option"><div class="support-icon">âš¡</div><div class="support-title">Quick Connect</div><div class="support-desc">Get a fast response from priority departments for urgent matters.</div><button class="btn btn-danger btn-sm" style="margin-top:16px" onclick="selectSupport(this,'Quick Connect')">Quick Connect</button></div>
</div>
<div id="supportForm" style="display:none">
  <div class="card mb-6">
    <div class="card-header"><div class="card-title">ğŸ“ Submit Request</div><span id="selectedTypeLabel" class="badge badge-info"></span></div>
    <div class="card-body">
      <form method="POST" action="{{ url_for('get_support') }}">
        <input type="hidden" name="type" id="supportType">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px">
          <div class="form-group"><label>Department *</label>
            <select name="department" required><option value="">Select Department</option>
              <option>Roads & Infrastructure</option><option>Sanitation & Environment</option>
              <option>Water & Utilities</option><option>Public Safety</option>
              <option>Parks & Recreation</option><option>Emergency Services</option>
              <option>City Planning</option><option>General Enquiry</option>
            </select>
          </div>
          <div class="form-group"><label>Priority</label><select name="priority"><option>Normal</option><option>High</option><option>Urgent</option></select></div>
        </div>
        <div class="form-group"><label>Your Message *</label><textarea name="message" placeholder="Describe your issue or request in detail..." required style="min-height:140px"></textarea></div>
        <div style="display:flex;gap:12px">
          <button type="submit" class="btn btn-primary">ğŸ“¤ Submit Request</button>
          <button type="button" class="btn btn-outline" onclick="document.getElementById('supportForm').style.display='none'">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="section-title">ğŸ“ My Support Requests</div>
{% if consultations %}
<div class="card"><div class="card-body" style="padding:0"><div class="table-wrap"><table>
  <thead><tr><th>Type</th><th>Department</th><th>Message</th><th>Status</th><th>Admin Reply</th><th>Date</th></tr></thead>
  <tbody>
    {% for c in consultations %}
    <tr>
      <td>{% if c['type']=='Start Consultation' %}ğŸ¯{% elif c['type']=='Active Chat' %}ğŸ’¬{% else %}âš¡{% endif %} <strong>{{ c['type'] }}</strong></td>
      <td>{{ c['department'] or 'â€”' }}</td>
      <td><span style="font-size:.85rem;color:#64748b;display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:220px">{{ c['message'] }}</span></td>
      <td><span class="badge badge-{{ 'progress' if c['status']=='Open' else 'resolved' }}">{{ 'ğŸ”“ Open' if c['status']=='Open' else 'âœ… Closed' }}</span></td>
      <td class="text-sm">{{ c['admin_reply'] or 'Awaiting reply...' }}</td>
      <td class="text-muted text-sm">{{ c['created_at'][:10] }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table></div></div></div>
{% else %}
<div class="card"><div class="card-body" style="text-align:center;padding:48px"><div style="font-size:3rem;margin-bottom:12px">ğŸ“­</div><h3>No support requests yet</h3><p class="text-muted">Choose a support type above to get started.</p></div></div>
{% endif %}
<div class="card mt-6">
  <div class="card-header"><div class="card-title">ğŸ“ Emergency Contacts</div></div>
  <div class="card-body">
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px">
      <div style="padding:16px;background:#fff5f5;border:1px solid #fecaca;border-radius:10px;text-align:center"><div style="font-size:2rem;margin-bottom:8px">ğŸš¨</div><div style="font-weight:700;color:#dc2626">Emergency</div><div style="font-size:1.2rem;font-weight:800;color:#991b1b">911</div></div>
      <div style="padding:16px;background:#eff6ff;border:1px solid #bfdbfe;border-radius:10px;text-align:center"><div style="font-size:2rem;margin-bottom:8px">ğŸ›ï¸</div><div style="font-weight:700;color:#1e40af">City Hall</div><div style="font-size:.95rem;color:#1e40af">(555) 100-2000</div></div>
      <div style="padding:16px;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:10px;text-align:center"><div style="font-size:2rem;margin-bottom:8px">ğŸ’§</div><div style="font-weight:700;color:#166534">Water Dept.</div><div style="font-size:.95rem;color:#166534">(555) 100-3000</div></div>
      <div style="padding:16px;background:#fefce8;border:1px solid #fde68a;border-radius:10px;text-align:center"><div style="font-size:2rem;margin-bottom:8px">ğŸ”§</div><div style="font-weight:700;color:#92400e">Public Works</div><div style="font-size:.95rem;color:#92400e">(555) 100-4000</div></div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
function selectSupport(btn,type){document.getElementById('supportType').value=type;document.getElementById('selectedTypeLabel').textContent=type;const f=document.getElementById('supportForm');f.style.display='block';f.scrollIntoView({behavior:'smooth'});}
</script>
{% endblock %}